<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>about_Broker_ErrorHandling - Citrix PowerShell SDK Documentation</title>
  

  <link rel="shortcut icon" href="
https://www.citrix.com/etc/designs/citrix/icon-favicon.png">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/base.css">
  <link rel="stylesheet" href="../../css/highlight.css">
  <link rel="stylesheet" href="../../css/override.css" type="text/css" />
  <link rel="stylesheet" href="../../css/font-awesome.css" type="text/css" />

  
  <script>
    // Current page data
    var mkdocs_page_name = "about_Broker_ErrorHandling";
    var mkdocs_page_input_path = "Broker/about_Broker_ErrorHandling.md";
    var mkdocs_page_url = "/Broker/about_Broker_ErrorHandling/";
  </script>
  
  <script src="../../js/jquery-1.10.2.min.js"></script>
  <script src="../../js/bootstrap-3.0.3.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script>
  <script src="../../js/base.js"></script>
  <script src="../../js/custom.js"></script>
  <script src="../../js/nav.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document" data-spy="scroll" data-target=".bs-sidebar">

	<div class="header-top">
		<div class="header-top-left">
			<a href="http://citrix.github.io" class="logo-position"><img height="60" src="https://thumbnail-ec2.sharefile.com/thumbnail.aspx?encparams=ypL2J0l-In6gqXJ7yeyKP8A1rqwKMH-C8-nfkJcHJNIN7Y0yZiJsYOcUe-uc0YeZzWLQSFSd1FnuMHPa30XSSINHuGOA8nvvnBT5WmjGlKvd5mxJ4IfT7iTVyHELwhWQiNCznPCiIFyhkA78uKX77PlU2iyhM4YdRM1NKabBe-4wXuiFJsbtAxyJ2UukO_E2ZSf1W3l75Dw8G0zflVkT-EFqyx1zSGId0qzLjm6nzJ8dA9zo-1AJzUisdzmGMzHOq_LMsOWyaalvmcWvCkl-q10GBSbfekfTIFW9LpZNYjkLNSnK8rcwNjWVr_jYayrGjIj2e5dDIMiDj3NRvW51AvHRjxYH9xRRRtY$" target="_blank" class="logo-citrix"><span style="color:#fff;font-size: 20px;position: relative;top:4px;left: 5px">SDK Reference</span></a>
		</div>
		<div class="header-top-right">
			<ul>
			<!--	<li class="list-inline home"><a href="../..">HOME</a></li>
				<li class="list-inline support"><a href="http://support.citrix.com">SUPPORT</a></li>-->
				<form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
            <li class="list-inline support"><input name="q" id="txtName" type="text" placeholder="Search SDKs"
            class="searchdocs">
<a class="fa fa-search errspan"></a></li>
</form>
				<!--<li class="list-inline"><a href="http://citrix.com/download">DOWNLOADS</a></li>-->
			</ul>

		</div>
	</div>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
	<i class="fa fa-search"></i>
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" role="navigation" aria-label="main navigation">
			<div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#topic">TOPIC</a></li>
        
    
        <li class="main "><a href="#short-description">SHORT DESCRIPTION</a></li>
        
    
        <li class="main "><a href="#long-description">LONG DESCRIPTION</a></li>
        
    
        <li class="main "><a href="#non-terminating-errors">NON-TERMINATING ERRORS</a></li>
        
    
        <li class="main "><a href="#terminating-errors">TERMINATING ERRORS</a></li>
        
    
        <li class="main "><a href="#class-sdkoperationexception">Class SdkOperationException</a></li>
        
    
        <li class="main "><a href="#review-of-powershell-error-handling-behavior">REVIEW OF POWERSHELL ERROR HANDLING BEHAVIOR</a></li>
        
    
        <li class="main "><a href="#accessing-error-record-data">ACCESSING ERROR RECORD DATA</a></li>
        
    
    </ul>
</div>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      


      
      <div class="wy-nav-content">
        <div class="rst-content">
         <!-- <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Broker &raquo;</li>
        
      
    
    <li>about_Broker_ErrorHandling</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div> -->
          <div role="main">
            <div class="section">
             
                <p>﻿# about_Broker_ErrorHandling</p>
<h2 id="topic"><a class="toclink" href="#topic">TOPIC</a></h2>
<div class="codehilite"><pre><span></span>Citrix Broker SDK - Error Handling
</pre></div>


<h2 id="short-description"><a class="toclink" href="#short-description">SHORT DESCRIPTION</a></h2>
<div class="codehilite"><pre><span></span>Describes broker errors generated by cmdlets and how to access them.
</pre></div>


<h2 id="long-description"><a class="toclink" href="#long-description">LONG DESCRIPTION</a></h2>
<div class="codehilite"><pre><span></span>The broker SDK cmdlets report errors through the class SdkErrorRecord, which 
is a subclass of the standard Powershell error record class 
System.Management.Automation.ErrorRecord. SdkErrorRecord contains:

o   A short string to describe the error status code. This is implemented 
    as a public property named Status. 
o   A dictionary of key-value pairs containing additional data specific to 
    the cmdlet. This is implemented as a public property named ErrorData 
    of type Dictionary&lt;string, string&gt;.

The error status property always has a value. Populating the error data 
dictionary is optional. The number of entries within the dictionary, the 
content of the entries, and the exact format of the key and value data is 
specific to each cmdlet.

You can access an SdkErrorRecord object using the standard Powershell cmdlet 
ErrorVariable parameter. The type of object returned by ErrorVariable 
depends on whether the error is terminating or non-terminating.
</pre></div>


<h2 id="non-terminating-errors"><a class="toclink" href="#non-terminating-errors">NON-TERMINATING ERRORS</a></h2>
<div class="codehilite"><pre><span></span>For non-terminating errors, each object in the returned ErrorVariable array 
is simply an instance of type SdkErrorRecord.
</pre></div>


<h2 id="terminating-errors"><a class="toclink" href="#terminating-errors">TERMINATING ERRORS</a></h2>
<div class="codehilite"><pre><span></span>For terminating errors, the object returned by ErrorVariable is of type 
System.Management.Automation.CmdletInvocationException.

For non-terminating errors that are escalated as terminating errors (through 
the &quot;ErrorAction stop&quot; argument), the object returned by ErrorVariable is of 
type System.Management.Automation.ActionPreferenceStopException.

CmdletInvocationException and ActionPreferenceStopException are subclasses 
of the base class System.Management.Automation.RuntimeException, which 
exposes the SdkErrorRecord object through its ErrorData property.
</pre></div>


<h2 id="class-sdkoperationexception"><a class="toclink" href="#class-sdkoperationexception">Class SdkOperationException</a></h2>
<div class="codehilite"><pre><span></span>SdkErrorRecord&#39;s Exception property holds an instance of custom exception 
class SdkOperationException, which also contains the error status code and 
data dictionary from SdkErrorRecord.

The SDK cmdlets generate errors in response to exceptions generated by the 
underlying system or by the cmdlet detecting errors locally and 
instantiating appropriate exception types. Such exceptions, which represent 
the original cause of the terminating error, are specified in 
SdkOperationException&#39;s InnerException property.

For terminating errors, use Powershell scripts to trap SdkOperationException 
and access additional error information and the originating exception.
</pre></div>


<h2 id="review-of-powershell-error-handling-behavior"><a class="toclink" href="#review-of-powershell-error-handling-behavior">REVIEW OF POWERSHELL ERROR HANDLING BEHAVIOR</a></h2>
<div class="codehilite"><pre><span></span><span class="x">Powershell scripts can access error information using the following methods:</span>

<span class="x">o   Read error records from the </span><span class="p">$</span><span class="nv">error</span><span class="x"> arraylist. </span>
<span class="x">o   Get the cmdlet to return error records using the standard ErrorVariable </span>
<span class="x">    cmdlet parameter. </span>
<span class="x">o   Use trap blocks to catch exceptions for terminating errors.</span>

<span class="x">The type of the error record that Powershell puts in the </span><span class="p">$</span><span class="nv">error</span><span class="x"> arraylist </span>
<span class="x">and returns through the ErrorVariable cmdlet parameter depends on whether </span>
<span class="x">the error is terminating or non-terminating, and whether the &quot;ErrorAction </span>
<span class="x">continue&quot; or &quot;ErrorAction stop&quot; cmdlet parameters are specified (that turn </span>
<span class="x">terminating errors into non-terminating ones, and vice versa).</span>

<span class="x">For the combinations of error types (terminating, non-terminating) and error </span>
<span class="x">actions (stop, continue), the following statements describe the relationship </span>
<span class="x">between:</span>

<span class="x">o   The type of object contained in the Powershell </span><span class="p">$</span><span class="nv">error</span><span class="x"> arraylist. </span>
<span class="x">o   The type of object returned by the ErrorVariable cmdlet parameter </span>
<span class="x">    (assuming the script can continue after a terminating error). </span>
<span class="x">o   The type of the exception that is thrown (where applicable).</span>

<span class="x">Non-terminating errors with ErrorAction=Continue, </span>
<span class="p">$</span><span class="nv">error</span><span class="x"> type=SdkErrorRecord, and ErrorVariable type=SdkErrorRecord do not </span>
<span class="x">throw an exception.</span>

<span class="x">Terminating errors with ErrorAction=Stop, </span><span class="p">$</span><span class="nv">error</span><span class="x"> type=ErrorRecord, and </span>
<span class="x">ErrorVariable type=CmdletInvocationException throw an SdkOperationException </span>
<span class="x">exception.</span>

<span class="x">Non-terminating errors with ErrorAction=Stop, </span><span class="p">$</span><span class="nv">error</span><span class="x"> type=ErrorRecord, and </span>
<span class="x">ErrorVariable type=ActionPreferenceOperationException do not throw an </span>
<span class="x">exception.</span>

<span class="x">Terminating errors with ErrorAction=Continue, </span><span class="p">$</span><span class="nv">error</span><span class="x"> type=ErrorRecord, and </span>
<span class="x">ErrorVariable type= CmdletInvocationException throw an SdkOperationException </span>
<span class="x">exception.</span>

<span class="x">ActionPreferenceOperationException and CmdletInvocationException are </span>
<span class="x">subclasses of System.Management.Automation.RuntimeException.</span>
</pre></div>


<h2 id="accessing-error-record-data"><a class="toclink" href="#accessing-error-record-data">ACCESSING ERROR RECORD DATA</a></h2>
<div class="codehilite"><pre><span></span><span class="x">The Powershell code sample below demonstrates how to access error </span>
<span class="x">information programmatically with the ErrorVariable cmdlet parameter and a </span>
<span class="x">trap block.</span>

<span class="err">#</span><span class="x"> Trap exceptions generated from terminating errors </span>
<span class="x">trap  [Exception] </span><span class="err">{</span><span class="x"> </span>
<span class="x">    write &quot;&quot; </span>
<span class="x">    write &quot;TRAP BLOCK : BEGIN”</span>

<span class="x">    if(</span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">Exception</span><span class="p">.</span><span class="nv">GetType</span><span class="p">().</span><span class="nv">Name</span><span class="x"> -eq &quot;SdkOperationException&quot;) </span>
<span class="x">    </span><span class="err">{</span><span class="x"> </span>
<span class="x">        </span><span class="p">$</span><span class="nv">sdkOpEx</span><span class="x"> = </span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">Exception</span><span class="x"></span>

<span class="x">        </span><span class="err">#</span><span class="x"> show error status </span>
<span class="x">        write </span><span class="p">$(</span><span class="s2">&quot;SdkOperationException.Status = &quot;</span> <span class="err">+</span> <span class="p">$</span><span class="nv">sdkOpEx</span><span class="p">.</span><span class="nv">Status</span><span class="p">)</span><span class="x"></span>

<span class="x">  </span><span class="err">#</span><span class="x"> show error data dictionary </span>
<span class="x">        write </span><span class="p">$(</span><span class="s2">&quot;SdkOperationException.ErrorData=&quot;</span><span class="p">)</span><span class="x"></span>

<span class="x">        write </span><span class="p">$(</span><span class="s2">&quot;SdkOperationException.InnerException = &quot;</span> <span class="err">+</span> <span class="p">$</span><span class="nv">sdkOpEx</span><span class="p">.</span><span class="nv">InnerException</span><span class="p">)</span><span class="x"> </span>
<span class="x">        </span><span class="p">$</span><span class="nv">_</span><span class="p">.</span><span class="nv">Exception</span><span class="p">.</span><span class="nv">ErrorData</span><span class="x"> </span>
<span class="x">    }</span>

<span class="x">    continue </span><span class="cp">#</span><span class="nf">could</span><span class="x"> also call break here to halt script execution </span>
<span class="x">    write &quot;TRAP BLOCK : END&quot; </span>
<span class="x">}</span>

<span class="cp">##</span><span class="c">######################################################################### </span><span class="x"></span>
<span class="cp">##</span><span class="c"> Run tests 1 to 4, below, in turn to examine terminating and </span><span class="x"></span>
<span class="cp">##</span><span class="c"> non-terminating error behavior. </span><span class="x"></span>
<span class="cp">##</span><span class="c">#########################################################################</span><span class="x"></span>

<span class="err">#</span><span class="x"> </span>
<span class="err">#</span><span class="x"> Test 1: Invoke cmdlet that generates a terminating error: </span>
<span class="err">#</span><span class="x">         New-BrokerCatalog throws terminating error if a </span>
<span class="err">#</span><span class="x">         catalog with the supplied name already exists. </span>
<span class="err">#</span><span class="x"> </span>
<span class="cp">#</span><span class="nf">New</span><span class="x">-BrokerCatalog -Name &quot;AlreadyExists&quot; -AllocationType Random -ProvisioningType Manual -SessionSupport SingleSession -PersistUserChanges OnLocal -MachinesArePhysical </span><span class="p">$</span><span class="nv">true</span><span class="x"> -ErrorVariable ev</span>

<span class="err">#</span><span class="x"> </span>
<span class="err">#</span><span class="x"> Test 2: Force script execution to continue after a terminating error. </span>
<span class="err">#</span><span class="x"> </span>
<span class="cp">#</span><span class="nf">New</span><span class="x">-BrokerCatalog -Name &quot;AlreadyExists&quot; -AllocationType Random -ProvisioningType Manual -SessionSupport SingleSession -PersistUserChanges OnLocal -MachinesArePhysical </span><span class="p">$</span><span class="nv">true</span><span class="x"> -ErrorVariable ev -ErrorAction continue</span>

<span class="err">#</span><span class="x"> </span>
<span class="err">#</span><span class="x"> Test 3: Invoke cmdlet that generates a non-terminating error: </span>
<span class="err">#</span><span class="x">         Get-BrokerCatalog generates a non-terminating error if a catalog </span>
<span class="err">#</span><span class="x">         with the specified name doesn&#39;t exist. </span>
<span class="err">#</span><span class="x"> </span>
<span class="cp">#</span><span class="nf">Get</span><span class="x">-BrokerCatalog -Name &quot;IDontExist&quot; -ErrorVariable ev</span>

<span class="err">#</span><span class="x"> </span>
<span class="err">#</span><span class="x"> Test 4 – Force script execution to halt after a non-terminating error. </span>
<span class="err">#</span><span class="x"> </span>
<span class="cp">#</span><span class="nf">Get</span><span class="x">-BrokerCatalog -Name &quot;IDontExist&quot; -ErrorVariable ev -ErrorAction &quot;stop&quot;</span>

<span class="x">write &quot;&quot; </span>
<span class="x">write &quot;GET ERROR INFORAMTION: BEGIN&quot;</span>

<span class="p">$</span><span class="nv">sdkErrRecord</span><span class="x"> = </span><span class="p">$</span><span class="nv">null</span><span class="x"></span>

<span class="x">if(</span><span class="p">$</span><span class="nv">ev</span><span class="x">[0].GetType().Name -eq &quot;SdkErrorRecord&quot;) </span>
<span class="err">{</span><span class="x"> </span>
<span class="x">    </span><span class="p">$</span><span class="nv">sdkErrRecord</span><span class="x"> = </span><span class="p">$</span><span class="nv">ev</span><span class="x">[0] </span>
<span class="x">}</span>

<span class="x">elseif(</span><span class="p">$</span><span class="nv">ev</span><span class="x">[0].GetType().BaseType.FullName -eq &quot;System.Management.Automation.RuntimeException&quot;) </span>
<span class="err">{</span><span class="x"> </span>
<span class="x">    </span><span class="p">$</span><span class="nv">sdkErrRecord</span><span class="x"> = </span><span class="p">$</span><span class="nv">ev</span><span class="x">[0].ErrorRecord </span>
<span class="x">} </span>
<span class="x">else </span>
<span class="err">{</span><span class="x"> </span>
<span class="x">  write (&quot;UNKNOWN ERROR VARIABLE TYPE:&quot;) </span>
<span class="x">  </span><span class="p">$</span><span class="nv">ev</span><span class="x">[0].GetType().Name </span>
<span class="x">}</span>

<span class="x">if(</span><span class="p">$</span><span class="nv">sdkErrRecord</span><span class="x"> -ne </span><span class="p">$</span><span class="nv">null</span><span class="x">) </span>
<span class="err">{</span><span class="x"> </span>
<span class="x">    write (&quot;Have sdkErrRecord:&quot;) </span>
<span class="x">    write (&quot;  Type Name = &quot; + </span><span class="p">$</span><span class="nv">sdkErrRecord</span><span class="p">.</span><span class="nv">GetType</span><span class="p">().</span><span class="nv">FullName</span><span class="x">) </span>
<span class="x">    write (&quot;  Status = &quot; + </span><span class="p">$</span><span class="nv">sdkErrRecord</span><span class="p">.</span><span class="nv">Status</span><span class="x">) </span>
<span class="x">    write (&quot;  Exception type = &quot; + </span><span class="p">$</span><span class="nv">sdkErrRecord</span><span class="p">.</span><span class="nv">Exception</span><span class="p">.</span><span class="nv">GetType</span><span class="p">().</span><span class="nv">FullName</span><span class="x">) </span>
<span class="x">    write (&quot;  ErrorData = &quot;) </span>
<span class="x">    </span><span class="p">$</span><span class="nv">sdkErrRecord</span><span class="p">.</span><span class="nv">ErrorData</span><span class="x"> </span>
<span class="x">    write (&quot;  FullyQualifiedErrorId = &quot; + </span><span class="p">$</span><span class="nv">sdkErrRecord</span><span class="p">.</span><span class="nv">FullyQualifiedErrorId</span><span class="x">) </span>
<span class="x">} </span>
<span class="x">write &quot;GET ERROR INFORAMTION: END&quot;</span>
</pre></div>
              

            </div>
          </div>

        </div>
      </div>

    </section>

  </div>

<!--<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span class="prev"><a href="../about_Broker_EntitlementPolicy/"><i class="fa fa-angle-left"></i> Previous</a></span>
      
      
        <span class="next"><a href="../about_broker_Filtering/">Next <i class="fa fa-angle-right"></i></a></span>
      
    </span>
	<div class="footer-right">
		<ul class="social-links">
			<li class="list-inline"><a href="https://twitter.com/citrix"><i class="fa fa-twitter"></i>@citrix</a></li>
			<li class="list-inline"><a href="mailto:support@citrix.com"><i class="fa fa-envelope-o"></i>support@citrix.com</a></li>
		</ul>
		<ul class="inner-pages">
			<li class="list-inline"><a href="http://citrix.com/about/legal">Privacy and Terms</li>
		</ul>
	</div>
</div>-->

</body>
</html>
